<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imagem para Texto e Vice-Versa</title>
</head>
<style>
    textarea,
    input {
        resize: none;
        border-radius: 5px;
        background-color: bisque;
        color: rgb(0, 0, 0);
    }

    button {
        resize: none;
        border-radius: 5px;
        background-color: rgb(146, 228, 154);
        color: rgb(0, 0, 0);
    }

    body {
        color: bisque;
        background-color: rgb(50 50 50);
    }
</style>

<body>

    <center>
        <h2>Selecione uma imagem:</h2>

        <input type="text" id="senha" placeholder="Senha"><br>
        <br>
        <input type="file" id="inputImagem" accept="image/*">
        <br>
        <br>


        <textarea id="saidaTexto" rows="5" cols="50"></textarea>

        <br>
        <button id="Revelation">Revelar codigo</button>

        <br>
        <hr><br>



        <img id="imgResultado" style="max-width: 80%; display: none;">



        <!---------------------->

        <!---------------------->


    </center>

    <script>

        const arrayFotos = [
            
            '',
            '',
            '',
            '',
            '',
        ]

        const center = document.createElement('center')

        var idct = 0

        arrayFotos.forEach(foto => {
            if(foto !==''){
                const div = document.createElement('div')

            const textarea = document.createElement('textarea')
            textarea.style.display = 'none'
            textarea.id = 'textarea_'+idct
            textarea.value = foto

            const input = document.createElement('input')
            input.type = 'text'
            input.placeholder = "nome marido da marquito minusculo"
            input.id = 'input_'+idct

            const button = document.createElement('button')
            button.innerHTML = 'Revelar'
            button.id = 'button_'+idct

            div.append(textarea)
            div.append(input)
            div.append(button)
            center.append(div)

            button.addEventListener('click', () => {
                revelar(textarea, input)
            })

            idct++
            }
        });

        document.body.append(center)




        document.getElementById('Revelation').addEventListener('click', () => {
            revelar(document.getElementById("saidaTexto"), document.getElementById("senha"))
        })




        function revelar(textarrea, key) {
            let base64 = textarrea.value.trim();

            if (base64) {
                let img = document.getElementById("imgResultado");
                img.src = "data:image/png;base64," + decrip(base64, joaat(key.value)); // Reconstruindo a URL Base64
                img.style.display = "block";
            } else {
                alert("O campo de texto está vazio!");
            }
        }

        function encrip(text, key) {
            let e = ''
            for (let i = 0; i < text.length; i++) {
                e += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length))
            }
            return btoa(e)
        }
        function decrip(text, key) {
            let e = atob(text)
            let d = ''
            for (let i = 0; i < e.length; i++) {
                d += String.fromCharCode(e.charCodeAt(i) ^ key.charCodeAt(i % key.length))
            }
            return d
        }


        function joaat(s) {
            s = s.toLowerCase();
            let h = 0;
            for (let i = 0; i < s.length; i++) {
                h += s.charCodeAt(i);
                h += (h << 10);
                h ^= (h >> 6);
            }
            h += (h << 3);
            h ^= (h >> 11);
            h += (h << 15);
            h = h >>> 0;
            return '0x' + h.toString(16).toUpperCase();
        }

        // Quando o usuário seleciona uma imagem
        document.getElementById("inputImagem").addEventListener("change", function (event) {
            let arquivo = event.target.files[0];
            if (arquivo) {
                let leitor = new FileReader();

                leitor.onload = function (e) {
                    // Convertendo os dados da imagem para Base64
                    let base64 = e.target.result.split(',')[1]; // Remove o prefixo "data:image/png;base64,"
                    document.getElementById("saidaTexto").value = encrip(base64, joaat(document.getElementById("senha").value));
                };

                // Lendo a imagem como uma URL Base64
                leitor.readAsDataURL(arquivo);
            }
        });




        //0x4646E655
    </script>

</body>

</html>